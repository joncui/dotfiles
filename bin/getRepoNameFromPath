#!/usr/bin/php -q
<?php
    function getComponentNameFromPath($path) {
        if (strpos($path, '/frpd') === false) {
            return array('type' => '', 'label' => $path, 'dir' => '');
        }

        $dir = '';

        preg_match('/\/(ser|app|mod)\w*\/([\w\-]+)\/?(.*)/', $path, $matchedRepoName);
        if (!empty($matchedRepoName)) {
            // sets second element to $type and first element to $label
            list($type, $label, $dir) = array_slice($matchedRepoName, 1);
        } else {
            preg_match('/frp(d)-(ufe900\d)\.lab1\.fanops\.net\/?(\w*)\/?(.*)/', $path, $matchedRepoName);

            if (!empty($matchedRepoName)) {
                list($type, $label, $dir) = array('', $matchedRepoName[3], $matchedRepoName[4]);
                $label = getShortLabel($label);
            }

            if (empty($label)) {
                $platformType = 'plat';
            }
        }

        if (!isset($type) || is_null($type)) {
            list($type, $label) = array('', '~' . str_replace('/home/jcui', '', $path));
        }

        // special case for modules
        if ($type === 'module') {
            $label = getModuleNameWithProperCasing($label);
            if ($label === '') {
                list($type, $label) = array('', '~' . str_replace('/home/jcui', '', $path));
            }
        }
        return array('type' => $type, 'label' => $label, 'dir' => $dir, 'platformType' => $platformType);
    }

    function getShortLabel($label) {
        switch ($label) {
            case 'static':
                return 'stat';
                break;
            case 'library':
                return 'lib';
                break;
            case 'login':
                return 'lgn';
                break;
            case 'tools':
                return 'tool';
                break;
            default:
                return $label;
        }
    }

    function getModuleNameWithProperCasing($moduleName) {
        switch (strtolower($moduleName)) {
            case 'jobsprocessor':
                return 'JobsProcessor';
                break;
            case 'messagequeue':
                return 'MessageQueue';
                break;
            case 'orm':
                return 'Orm';
                break;
            case 'reportingengine':
                return 'ReportingEngine';
                break;
            case 'reportingenginevalidator':
                return 'ReportingEngineValidator';
                break;
            case 'scheduler':
                return 'Scheduler';
                break;
            case 'authorization':
                return 'Authorization';
                break;
            case 'httpclient':
                return 'HttpClient';
                break;
            case 'sling':
                return 'Sling';
                break;
            case 'email':
                return 'Email';
                break;
            case 'targetingengine':
                return 'TargetingEngine';
                break;
            default:
                return '';
        }
    }

    function getRepoNameFromPath($path) {
        $componentName = getComponentNameFromPath($path);

        if ($componentName['platformType']) {
            return $componentName['platformType'];
        }
        return (empty($componentName['type']) ? '' : ($componentName['type'] . '-')) . $componentName['label'] . ' ' . $componentName['dir'];
    }

    echo getRepoNameFromPath($argv[1]);
